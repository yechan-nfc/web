<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi"/>
    <title>main</title>
    <style type="text/css">
        html,
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
    
        #wrap {
            position: relative;
            max-width: 420px;
            min-width: 300px;
            max-height: 850px;
            min-height: 550px;
            width: 100%;
            height: 100%;
            background: rgb(255, 255, 255);
        }

        #blankSpace {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            z-index: 1; 
            opacity: 0.1;
            background-color: rgb(255, 255, 255);
			visibility: visible;
        }

        #blankSpace2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            z-index: 1; 
            opacity: 0.1;
            background-color: rgb(255, 255, 255);
			visibility: hidden;
        }

        #mainTutorial1 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.5;
            background-color: black;
			visibility: hidden;
        }

        #mainTutorial2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.5;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial1 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.5;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.5;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial3 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.5;
            background-color: black;
			visibility: hidden;
        }

        #tutorialWord {
            position: relative;
            top: 45%;
            font-size: 18px;
            color: white;
        }

        #uploadbutton {
            position: absolute;
            top: 3%;
            left: 5%;
            width: 13%;
            height: 35px;
            text-align: center;
            font-size: 15px;
		    color: rgb(0, 0, 0);
            background-color: #F5F5F5;
            border: none;
            border-radius: 30px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.2), 0 0.7px 2.5px 0 rgba(0,0,0,0.19);
            visibility: visible;
        }

        #recordpausebutton {
            position: absolute;
            top: 10%;
            left: 44%;
            width: 12%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: hidden;
        }
        #recordpausebutton img { margin: 0%; width: 100%;}

        #deletebutton {
            position: absolute;
            top: 10%;
            left: 45%;
            width: 10%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: hidden;
        }
        #deletebutton img { margin: 0%; width: 100%;}

        #timer {
            position: absolute;
            top: 25%;
            left: 42%;
            visibility: hidden;
        }

        #waterdrop {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            visibility: visible;
        }

        #playbutton {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: hidden;
            cursor: move;
        }
        #playbutton img { margin: 0%; width: 100%;}

        #pausebutton {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: hidden;
        }
        #pausebutton img { margin: 0%; width: 100%;}

        #dragdirection {
            position: absolute;
            top: 60%;
            left: 49%;
            width: 2%;
            visibility: hidden;
        }

        #dragposition {
            position: absolute;
            bottom: 3%;
            left: 30%;
            width: 40%;
            visibility: hidden;
        }

        #recordbutton {
            position: absolute;
            bottom: 10%;
            left: 41%;
            width: 18%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: visible;
        }
        #recordbutton img { margin: 0%; width: 100%;}

        #stopbutton {
            position: absolute;
            bottom: 10%;
            left: 41%;
            width: 18%;
            padding: 0%;
            border: none;
            background-color: white;
            visibility: hidden;
        }
        #stopbutton img { margin: 0%; width: 100%;}
    </style>
</head>
<body>
    <div id="wrap">
        <div id="blankSpace" onclick="blankSpaceDel()"></div>
        <div id="mainTutorial1" onclick="mainTutorial1Del()">
            <p id="tutorialWord">녹음 버튼을 눌러 녹음</p>
            <img style="position:absolute; bottom: 10.5%; left: 41%; width: 18%; border-radius: 70%; opacity: 1;"
                src="./img/button_record.jpg" alt="record button img">
        </div>
        <div id="mainTutorial2" onclick="mainTutorial2Del()">
            <button style="position: absolute; top: 3%; left: 5%; width: 13%; height: 35px; text-align: center; font-size: 15px; color: rgb(0, 0, 0); background-color: #F5F5F5;
                    border: none; border-radius: 30px;">+</button>
            <p id="tutorialWord">+버튼을 눌러 파일 불러오기</p>
        </div>
        <div id="blankSpace2" onclick="blankSpace2Del()"></div>
        <div id="recordTutorial1" onclick="recordTutorial1Del()">
            <p style="position:relative; top: 20%; font-size: 18px; color: white;">재생 버튼을 눌러 다시 듣기</p>
            <img style="position: absolute; top: 44%; left: 45%; width: 10%; opacity: 1;" src="./img/recordtutorial_play.jpg" alt="play button"> 
        </div>
        <div id="recordTutorial2" onclick="recordTutorial2Del()">
            <p style="position:relative; top: 18%; font-size: 18px; color: white;">아래로 드래그해서<br>스티커에 소리 저장하기</p>
            <img style="position: absolute; top: 32%; left: 30%; width: 40%;" src="./img/waterdrop_playbutton.jpg" alt="play button"> 
        </div>
        <div id="recordTutorial3" onclick="recordTutorial3Del()">
            <img style="position: absolute; top: 10%; left: 45%; width: 10%;" src="./img/button_delete.jpg" alt="delete button img">
            <p style="position:relative; top: 18%; font-size: 18px; color: white;">휴지통을 클릭해서<br>삭제 후 재녹음하기</p> 
        </div>
        <script>
            function blankSpaceDel(){
                document.all.blankSpace.style.visibility="hidden";
                document.all.mainTutorial1.style.visibility="visible";
            }
            function mainTutorial1Del(){
                document.all.mainTutorial1.style.visibility="hidden";
                document.all.mainTutorial2.style.visibility="visible";
            }
            function mainTutorial2Del(){
                document.all.mainTutorial2.style.visibility="hidden";
            }
            function blankSpace2Del(){
                document.all.blankSpace2.style.visibility="hidden";
                document.all.recordTutorial1.style.visibility="visible";
            }
            function recordTutorial1Del(){
                document.all.recordTutorial1.style.visibility="hidden";
                document.all.recordTutorial2.style.visibility="visible";
            }
            function recordTutorial2Del(){
                document.all.recordTutorial2.style.visibility="hidden";
                document.all.recordTutorial3.style.visibility="visible";
            }
            function recordTutorial3Del(){
                document.all.recordTutorial3.style.visibility="hidden";
            }
        </script>

        <button id="uploadbutton" class="upload">+</button>
        <button id="recordpausebutton" class="recordpause"><img src="./img/button_pause.jpg" alt="pause button img"></button>
        <button id="deletebutton" class="delete"><img src="./img/button_delete.jpg" alt="delete button img"></button>

        <p id="timer">00:00:00</p>
        <img id="waterdrop" src="./img/waterdrop_blank.jpg" alt="water drop blank img">
        <audio class="record-audio"></audio>
        <button id="playbutton" class="play"><img src="./img/waterdrop_playbutton.jpg" alt="water drop play img"></button>
        <button id="pausebutton" class="pause"><img src="./img/waterdrop_pausebutton.jpg" alt="water drop pause img"></button>
        
        <button id="recordbutton" class="record"><img src="./img/button_record.jpg" alt="record button img"></button>
        <button id="stopbutton" class="stop"><img src="./img/button_stop.jpg" alt="stop button img"></button>

        <img id="dragdirection" src="./img/direction_dropdown.jpg" alt="drop down direction img">
        <img id="dragposition" src="./img/waterdrop_dropdown.jpg" alt="drop down position">
    </div>
    <script>
        const record = document.querySelector('.record');
        const resume = document.querySelector('.resume');
        const pause = document.querySelector('.recordpause'); 
        const stop = document.querySelector('.stop');

        stop.disabled = true;
        
        let audioCtx;
    
        if (navigator.mediaDevices.getUserMedia) {
            console.log('getUserMedia supported.');

            const constraints = { audio: true };
            let chunks = [];

            let onSuccess = function (stream) {
                const mediaRecorder = new MediaRecorder(stream);

                record.onclick = function () {
                    mediaRecorder.start();
                    console.log(mediaRecorder.state);
                    console.log("recorder started");
                    
                    document.all.waterdrop.src="./img/waterdrop_charge.jpg";
                    document.all.uploadbutton.style.visibility="hidden";
                    document.all.recordbutton.style.visibility="hidden";
                    document.all.recordpausebutton.style.visibility="visible";
                    document.all.stopbutton.style.visibility="visible";
                    document.all.timer.style.visibility="visible";

                    stop.disabled = false;
                    record.disabled = true;
                }

                /*
                pause.onclick = function () {
                    mediaRecorder.pause();
                    console.log(mediaRecorder.state);
                    console.log("recorder paused");
                    
                    document.all.waterdrop.src="./img/waterdrop_playbutton.jpg"
                    document.all.recordbutton.style.visibility="visible";
                    document.all.recordpausebutton.style.visibility="hidden";

                    stop.disabled = false;
                    record.disabled = true;
                }
                
                resume.onclick = function () {
                    mediaRecorder.resume();
                    console.log(mediaRecorder.state);
                    console.log("recorder started");
                    
                    document.all.waterdrop.src="./img/waterdrop_charge.jpg"
                    document.all.recordbutton.style.visibility="hidden";
                    document.all.recordpausebutton.style.visibility="visible";

                    stop.disabled = false;
                    record.disabled = true;
                }*/

                stop.onclick = function () {
                    mediaRecorder.stop();
                    console.log(mediaRecorder.state);
                    console.log("recorder stopped");
                    // mediaRecorder.requestData();
                    
                    document.all.waterdrop.style.visibility="hidden";
                    document.all.playbutton.style.visibility="visible";
                    document.all.recordpausebutton.style.visibility="hidden";
                    document.all.stopbutton.style.visibility="hidden";
                    document.all.deletebutton.style.visibility="visible";
                    document.all.dragdirection.style.visibility="visible";
                    document.all.dragposition.style.visibility="visible";
                    document.all.blankSpace2.style.visibility="visible";

                    stop.disabled = true;
                    record.disabled = false;
                }

                mediaRecorder.onstop = function (e) {
                    console.log("data available after MediaRecorder.stop() called.");

                    const audio = document.querySelector('.record-audio'); 

                    audio.controls = false;
                    const blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });
                    chunks = [];
                    const audioURL = window.URL.createObjectURL(blob);
                    audio.src = audioURL;
                    console.log("recorder stopped");

                    playbutton.onclick = function (e) {
                        audio.play();

                        document.all.playbutton.style.visibility="hidden";
                        document.all.pausebutton.style.visibility="visible";
                    }

                    pausebutton.onclick = function (e) {
                        audio.pause();

                        document.all.playbutton.style.visibility="visible";
                        document.all.pausebutton.style.visibility="hidden";
                    }

                    audio.addEventListener('ended', function() { 
                        this.currentTime = 0;
                        
                        document.all.playbutton.style.visibility="visible";
                        document.all.pausebutton.style.visibility="hidden";
                    }, false);
                    
                    deletebutton.onclick = function (e) {
                        audio.src = "none";

                        document.all.playbutton.style.visibility="hidden";
                        document.all.deletebutton.style.visibility="hidden";
                        document.all.dragdirection.style.visibility="hidden";
                        document.all.dragposition.style.visibility="hidden";
                        document.all.waterdrop.style.visibility="visible";
                        document.all.waterdrop.src="./img/waterdrop_blank.jpg";
                        document.all.uploadbutton.style.visibility="visible";
                        document.all.recordbutton.style.visibility="visible";
                        document.all.recordpausebutton.style.visibility="hidden";
                        document.all.stopbutton.style.visibility="hidden";
                        document.all.timer.style.visibility="hidden";
                        console.log("record file deleted");
                    }
                }

                mediaRecorder.ondataavailable = function (e) {
                    chunks.push(e.data);
                }
            }

            let onError = function (err) {
                console.log('The following error occured: ' + err);
            }

            navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);

        } else {
            console.log('getUserMedia not supported on your browser!');
        }
    </script>
</body>
</html>